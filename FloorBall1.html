<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Phaser 3 Salibandypeli</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style>
        body {
            margin: 0;
        }

        canvas {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <script type="text/javascript">var config = {
    type: Phaser.AUTO,
    width: 1000,
    height: 600,
    backgroundColor: '#228B22',
    physics: {
        default: 'arcade',
        arcade: {
            gravity: { y: 0 },
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var player;
var ball;
var goals;
var blueTeam = [];
var redTeam = [];
var cursors;
var spaceKey;
var activePlayerIndex = 0; // Ohjattava pelaaja
var score = { blue: 0, red: 0 };
var scoreText;

var game = new Phaser.Game(config);

function preload() {
    // Yksinkertaiset grafiikat
    this.load.image('field', 'assets/kentta.png'); // kenttä
    this.load.image('goal', 'assets/maali.png'); // maali
    this.load.image('goal2', 'assets/maali2.png'); // maali
    this.load.image('ball', 'assets/pallo.png'); // pallo
    this.load.image('blue', 'assets/pelaaja_sininen.png'); // sininen pelaaja
    this.load.image('red', 'assets/pelaaja_punainen.png'); // punainen pelaaja
}

function create() {
    // Kenttä
    this.add.image(500, 300, 'field');

    // Maalit
    goals = [
        this.physics.add.staticImage(50, 300, 'goal'), // vasen
        this.physics.add.staticImage(950, 300, 'goal2') // oikea
    ];

    // Sininen joukkue
    for (let i = 0; i < 3; i++) {
        let p = this.physics.add.sprite(200, 200 + i * 100, 'blue');
        p.setCollideWorldBounds(true);
        blueTeam.push(p);
    }

    // Punainen joukkue
    for (let i = 0; i < 3; i++) {
        let p = this.physics.add.sprite(800, 200 + i * 100, 'red');
        p.setCollideWorldBounds(true);
        redTeam.push(p);
    }

    // Pallo
    ball = this.physics.add.sprite(500, 300, 'ball');
    ball.setCollideWorldBounds(true);
    ball.setBounce(0.8);

    // Pelaaja, jota ohjataan (sinisen joukkueen ensimmäinen)
    player = blueTeam[activePlayerIndex];

    // Syöttö/laukaisu
    cursors = this.input.keyboard.createCursorKeys();
    spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

    // Pelaajien ja pallon törmäykset
    blueTeam.forEach(p => {
        this.physics.add.collider(p, ball);
        this.physics.add.collider(p, redTeam);
    });
    redTeam.forEach(p => {
        this.physics.add.collider(p, ball);
        this.physics.add.collider(p, blueTeam);
    });

    // Pallo ja maalit
    this.physics.add.overlap(ball, goals[0], () => goalScored('red'), null, this);
    this.physics.add.overlap(ball, goals[1], () => goalScored('blue'), null, this);

    // Pistetaulu
    scoreText = this.add.text(400, 16, 'Sininen: 0  Punainen: 0', { fontSize: '32px', fill: '#fff' });
}

function update() {
    // Pelaajan ohjaus
    player.setVelocity(0);

    if (cursors.left.isDown) {
        player.setVelocityX(-200);
    }
    if (cursors.right.isDown) {
        player.setVelocityX(200);
    }
    if (cursors.up.isDown) {
        player.setVelocityY(-200);
    }
    if (cursors.down.isDown) {
        player.setVelocityY(200);
    }

    // Syöttö/laukaisu
    if (Phaser.Input.Keyboard.JustDown(spaceKey)) {
        // Jos pallo on lähellä pelaajaa
        if (Phaser.Math.Distance.Between(player.x, player.y, ball.x, ball.y) < 40) {
            // Laukaisu suuntaan, johon pelaaja liikkuu
            let vx = 0, vy = 0;
            if (cursors.left.isDown) vx = -400;
            else if (cursors.right.isDown) vx = 400;
            if (cursors.up.isDown) vy = -400;
            else if (cursors.down.isDown) vy = 400;
            // Jos ei liikettä, laukaus eteenpäin
            if (vx === 0 && vy === 0) vy = -400;
            ball.setVelocity(vx, vy);
        }
    }
}

function goalScored(team) {
    score[team]++;
    scoreText.setText('Sininen: ' + score.blue + '  Punainen: ' + score.red);
    // Resetoi pallon ja pelaajat
    ball.setPosition(500, 300);
    ball.setVelocity(0, 0);
    blueTeam.forEach((p, i) => p.setPosition(200, 200 + i * 100));
    redTeam.forEach((p, i) => p.setPosition(800, 200 + i * 100));
}</script>
</body>
</html>